# HTTP란?
> HTTP(HyperText Transfer Protocol)는 HTML 문서를 주고 받는 통신 규약

## 문제점
- 평문(암호화하지 않은) 통신이기 때문에 도청 가능
- 통신 상대를 확인하지 않기 때문에 위장이 가능하다.
- 완전성을 증명할 수 없기 때문에 변조가 가능하다.

# HTTPS(HyperText Transfer Protocol Secure)
SSL(보안 소켓 계층, TLS라고도 부른다.)을 사용하여 서버에서 브라우저로 전송되는 정보를 암호화한다.
HTTP 는 원래 TCP 와 직접 통신했지만, HTTPS 에서 HTTP 는 SSL 과 통신하고 SSL 이 TCP 와 통신 하게 된다. 
SSL 을 사용한 HTTPS 는 암호화와 증명서, 안전성 보호를 이용할 수 있게 된다.

# SSL
> SSL 인증서는 클라이언트와 서버간의 통신을 제3자가 보증해주는 전자화된 문서다. 

클라이언트가 서버에 접속한 직후에 서버는 클라이언트에게 이 인증서 정보를 전달한다. 
클라이언트는 이 인증서 정보가 신뢰할 수 있는 것인지를 검증 한 후에 다음 절차를 수행하게 된다. 
이점은 아래와 같다.

1. 통신 내용이 공격자에게 노출되는 것을 막을 수 있다. 
2. 클라이언트가 접속하려는 서버가 신뢰 할 수 있는 서버인지를 판단할 수 있다.
3. 통신 내용의 악의적인 변경을 방지할 수 있다. 

# SSL에서 사용하는 암호화 기법
- 대칭키 :  대칭키는 동일한 키로 암호화와 복호화를 같이 할 수 있는 방식의 암호화 기법을 의미 <br/>
           암호를 주고 받는 사람들 사이에 대칭키를 전달하는 것이 어렵다는 단점이 있음 <br/>
           대칭키가 유출되면 키를 획득한 공격자는 암호의 내용을 복호화 할 수 있기 때문에 암호가 무용지물 <br/>

- 공개키 : 두개의 키를 가짐 <br/>
           A키로 암호화를 하면 B키로 복호화 할 수 있고, B키로 암호화하면 A키로 복호화 할 수 있는 방식 <br/>
           
           이 방식에 착안해서 
           1. 두개의 키 중 하나를 비공개키(private key, 개인키, 비밀키라고도 부른다)로하고, 나머지를 공개키(public key)로 지정한다. 
           2. 비공개키는 자신만이 가지고 있고, 공개키를 타인에게 제공한다.
           3. 공개키를 제공 받은 타인은 공개키를 이용해서 정보를 암호화한다. 
           4. 암호화한 정보를 비공개키를 가지고 있는 사람에게 전송한다. 
           5. 비공개키의 소유자는 이 키를 이용해서 암호화된 정보를 복호화 한다

- 전자서명 : 비공개키의 소유자는 비공개키를 이용해서 정보를 암호화 한 후에 공개키와 함께 암호화된 정보를 전송한다. 정보와 공개키를 획득한 사람은 공개키를 이용해서 암호화된 정보를 복호화 한다. 이 과정에서 공개키가 유출된다면 의도하지 않은 공격자에 의해서 데이터가 복호화 될 위험이 있다. 데이터를 보호하려는 목적이 아닌 데이터를 제공한 사람의 신원을 보장하는데 목적이 있음

# SSL의 동작 방법
SSL은 암호화된 데이터를 전송하기 위해서 공개키와 대칭키를 혼합해서 사용
클라이언트와 서버가 주고 받는 실제 정보는 대칭키 방식으로 암호화하고, 대칭키 방식으로 암호화된 실제 정보를 복호화할 때사용할 대칭키는 공개키 방식으로 암호화해서 클라이언트와 서버가 주고 받는다. 

**네트워크 통신을 할때 내부적으로 일어나는 3가지 단계** <br/>
악수 -> 전송 -> 세션종료

- 악수 (handshake)
실제 데이터를 주고 받기 전에 클라이언트와 서버는 일종의 인사인 Handshake(진짜로 사용하는 기술용어다)를 한다. <br/>
이 과정을 통해서 서로 상대방이 존재하는지, 또 상대방과 데이터를 주고 받기 위해서는 어떤 방법을 사용해야하는지를 파악한다. <br/>
이 때 SSL 인증서를 주고 받는다. 

1. 클라이언트 서버 접속 (Client Hello) <br/>
   (클라이언트 측에서 생성한 랜덤 데이터, 클라이언트가 지원하는 암호화 방식, 세션 아이디 주고 받음) <br/>
2. Client Hello에 대한 응답으로 서버가 Server Hello <br/> ( 서버 측에서 생성한 랜덤 데이터, 서버가 선택한 클라이언트 암호화 방식, 인증서 주고받음) <br/>
3. 클라이언트는 서버의 인증서가 CA에 의해서 발급된 것인지를 확인하기 위해서 클라이언트에 내장된 CA 리스트를 확인 <br/>
    클라이언트는 상기 2번을 통해서 받은 서버의 랜덤 데이터와 클라이언트가 생성한 랜덤 데이터를 조합해서 pre master secret라는 키(대칭키)를 생성한다. <br/>
    서버의 공개키로 pre master secret 값을 암호화해서 서버로 전송<br/>

4. 서버는 클라이언트가 전송한 pre master secret 값을 자신의 비공개키로 복호화<br/>
pre master secret 값을 master secret 값으로 만든다. <br/>
master secret는 session key를 생성하는데 이 session key 값을 이용해서 서버와 클라이언트는 데이터를 대칭키 방식으로 암호화 한 후에 주고 받는다.<br/>

- 세션
세션은 실제로 서버와 클라이언트가 데이터를 주고 받는 단계
이 단계에서 핵심은 정보를 상대방에게 전송하기 전에 session key 값을 이용해서 대칭키 방식으로 암호화 한다는 점이다.

- 세션 종료
데이터의 전송이 끝나면 SSL 통신이 끝났음을 서로에게 알려준다. 이 때 통신에서 사용한 대칭키인 세션키를 폐기한다.

**그냥 공개키를 사용하면 될 것을 대칭키와 공개키를 조합해서 사용하는 이유**
- 공개키 방식이 많은 컴퓨터 파워를 사용하기 때문이다. 
반대로 대칭키는 암호를 푸는 열쇠인 대칭키를 상대에게 전송해야 하는데, 암호화가 되지 않은 인터넷을 통해서 키를 전송하는 것은 위험하기 때문이다. 그래서 속도는 느리지만 데이터를 안전하게 주고 받을 수 있는 공개키 방식으로 대칭키를 암호화하고, 실제 데이터를 주고 받을 때는 대칭키를 이용해서 데이터를 주고 받는 것이다.

❓:question: 결국 대칭키를 복호화 해야하지 않나???


## CA
인증서의 역할은 클라이언트가 접속한 서버가 클라이언트가 의도한 서버가 맞는지 보장하는 역할을 한다.<br/>
이 역할을 하는 민간기업들이 있는데 이런 기업들은 CA 혹은 Root Certificate라고 부른다.<br/>
CA를 브라우저는 알고 있다. 인증서를 이해하는데 꼭 알고 있어야 하는 것이 CA 리스트이다. 이 리스트는 브라우저에서 자체적으로 가지고 있다.<br/>
SSL을 통해서 암호화된 통신을 제공하려는 서비스는 CA를 통해서 인증서를 구입해야 한다. <br/>

## 모든 웹 페이지에서 HTTPS를 사용해도 될까?

평문 통신에 비해서 암호화 통신은 CPU나 메모리 등 리소스를 더 많이 요구한다.<br/>
통신할 때마다 암호화를 하면 추가적인 리소스를 소비하기 때문에 서버 한 대당 처리할 수 있는 리퀘스트의 수가 상대적으로 줄어들게 된다.<br/>
하지만 최근에는 하드웨어의 발달로 인해 HTTPS를 사용하더라도 속도 저하가 거의 일어나지 않으며, 새로운 표준인 HTTP 2.0을 함께 이용한다면 오히려 HTTPS가 HTTP보다 더 빠르게 동작한다. 

## 참고
https://opentutorials.org/course/228/4894
https://cheese10yun.github.io/https/
https://github.com/JaeYeopHan/Interview_Question_for_Beginner/tree/master/Network#http%EC%99%80-https
